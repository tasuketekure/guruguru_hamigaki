<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ぐるぐる通知登録</title>
</head>
<body>
  <h1>ぐるぐる通知登録ページ</h1>
  <button id="subscribe">通知を登録</button>
  <script>
    const publicVapidKey = "BMbdqOSU4gN7v_gHzO5NT2Gb0Pdgh_A20VSo1DPOb8oGNmTqDmjLCgrH_a7bka5NgQwvhZC9J4H-cbD6KvS0qXs";

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        const registration = await navigator.serviceWorker.register('/sw.js');
        document.getElementById('subscribe').addEventListener('click', async () => {
          const subscription = await registration.pushManager.subscribe({
            userVisibleOnly: true,
            applicationServerKey: publicVapidKey
          });
          await fetch("https://guru-push-server.onrender.com/subscribe", {
            method: "POST",
            body: JSON.stringify(subscription),
            headers: { "Content-Type": "application/json" }
          });
          alert("登録しました！");
        });
      });
    }
  </script>
</body>
</html>